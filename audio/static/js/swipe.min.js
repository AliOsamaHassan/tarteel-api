/*
 * Swipe 2.0
 *
 * Brad Birdsall
 * Copyright 2013, MIT License
 *
*/function Swipe(a,b){'use strict';// utilities
var m=Math.abs;function c(){q=u.children,t=q.length,2>q.length&&(b.continuous=!1),p.transitions&&b.continuous&&3>q.length&&(u.appendChild(q[0].cloneNode(!0)),u.appendChild(u.children[1].cloneNode(!0)),q=u.children),r=Array(q.length),s=a.getBoundingClientRect().width||a.offsetWidth,u.style.width=q.length*s+'px';for(// stack elements
var c,d=q.length;d--;)c=q[d],c.style.width=s+'px',c.setAttribute('data-index',d),p.transitions&&(c.style.left=d*-s+'px',h(d,v>d?-s:v<d?s:0,0));// reposition elements before and after index
b.continuous&&p.transitions&&(h(f(v-1),-s,0),h(f(v+1),s,0)),p.transitions||(u.style.left=v*-s+'px'),a.style.visibility='visible'}function d(){b.continuous?g(v-1):v&&g(v-1)}function e(){b.continuous?g(v+1):v<q.length-1&&g(v+1)}function f(a){// a simple positive modulo using slides.length
return(q.length+a%q.length)%q.length}function g(a,c){// do nothing if already on requested slide
if(v!=a){if(p.transitions){var d=m(v-a)/(v-a);// 1: backward, -1: forward
// get the actual position of the slide
if(b.continuous){var e=d;d=-r[f(a)]/s,d!=e&&(a=-d*q.length+a)}// move all the slides between index and to in the right direction
for(var g=m(v-a)-1;g--;)h(f((a>v?a:v)-g-1),s*d,0);a=f(a),h(v,s*d,c||w),h(a,0,c||w),b.continuous&&h(f(a-d),-(s*d),0)}else a=f(a),j(v*-s,a*-s,c||w);v=a,o(b.callback&&b.callback(v,q[v]))}}function h(a,b,c){i(a,b,c),r[a]=b}function i(a,b,c){var d=q[a],e=d&&d.style;e&&(e.webkitTransitionDuration=e.MozTransitionDuration=e.msTransitionDuration=e.OTransitionDuration=e.transitionDuration=c+'ms',e.webkitTransform='translate('+b+'px,0)translateZ(0)',e.msTransform=e.MozTransform=e.OTransform='translateX('+b+'px)')}function j(a,c,d){// if not an animation, just reposition
if(!d)return void(u.style.left=c+'px');var e=+new Date,f=setInterval(function(){var g=Math.floor,h=+new Date-e;return h>d?(u.style.left=c+'px',z&&k(),b.transitionEnd&&b.transitionEnd.call(event,v,q[v]),void clearInterval(f)):void(u.style.left=(c-a)*(g(100*(h/d))/100)+a+'px')},4)}// setup auto slideshow
function k(){x=setTimeout(e,z)}function l(){z=0,clearTimeout(x)}// setup initial vars
var n=function(){},o=function(a){setTimeout(a||n,0)},p={addEventListener:!!window.addEventListener,touch:'ontouchstart'in window||window.DocumentTouch&&document instanceof DocumentTouch,transitions:function(a){var b=['transitionProperty','WebkitTransition','MozTransition','OTransition','msTransition'];for(var c in b)if(void 0!==a.style[b[c]])return!0;return!1}(document.createElement('swipe'))};// simple no operation function
// offload a functions execution
// check browser capabilities
// quit if no root element
if(a){var q,r,s,t,u=a.children[0];b=b||{};var v=parseInt(b.startSlide,10)||0,w=b.speed||300;b.continuous=void 0===b.continuous||b.continuous;var x,y,z=b.auto||0,A={},B={},C={handleEvent:function(a){switch(a.type){// case 'touchstart': this.start(event); break;
// case 'touchmove': this.move(event); break;
// case 'touchend': offloadFn(this.end(event)); break;
case'webkitTransitionEnd':case'msTransitionEnd':case'oTransitionEnd':case'otransitionend':case'transitionend':o(this.transitionEnd(a));break;case'resize':o(c);}b.stopPropagation&&a.stopPropagation()},start:function(a){var b=a.touches[0];// measure start values
A={// get initial touch coords
x:b.pageX,y:b.pageY,// store time to determine touch duration
time:+new Date},y=void 0,B={},u.addEventListener('touchmove',this,!1),u.addEventListener('touchend',this,!1)},move:function(a){// ensure swiping with one touch and not pinching
if(!(1<a.touches.length||a.scale&&1!==a.scale)){b.disableScroll&&a.preventDefault();var c=a.touches[0];// measure change in x and y
B={x:c.pageX-A.x,y:c.pageY-A.y// determine if scrolling test has run - one time test
},'undefined'==typeof y&&(y=!!(y||m(B.x)<m(B.y))),y||(a.preventDefault(),l(),b.continuous?(i(f(v-1),B.x+r[f(v-1)],0),i(v,B.x+r[v],0),i(f(v+1),B.x+r[f(v+1)],0)):(B.x/=!v&&0<B.x// if first slide and sliding left
||v==q.length-1// or if last slide and sliding right
&&0>B.x// and if sliding at all
?m(B.x)/s+1:// determine resistance level
1,i(v-1,B.x+r[v-1],0),i(v,B.x+r[v],0),i(v+1,B.x+r[v+1],0)))}},end:function(){// measure duration
var a=+new Date-A.time,c=250>+a// if slide duration is less than 250ms
&&20<m(B.x)// and if slide amt is greater than 20px
||m(B.x)>s/2,d=!v&&0<B.x// if first slide and slide amt is greater than 0
||v==q.length-1&&0>B.x;// determine if slide attempt triggers next/prev slide
// or if slide amt is greater than half the width
// determine if slide attempt is past start and end
b.continuous&&(d=!1);// determine direction of swipe (true:right, false:left)
var e=0>B.x;// if not scrolling vertically
y||(c&&!d?(e?(b.continuous?(h(f(v-1),-s,0),h(f(v+2),s,0)):h(v-1,-s,0),h(v,r[v]-s,w),h(f(v+1),r[f(v+1)]-s,w),v=f(v+1)):(b.continuous?(h(f(v+1),s,0),h(f(v-2),-s,0)):h(v+1,s,0),h(v,r[v]+s,w),h(f(v-1),r[f(v-1)]+s,w),v=f(v-1)),b.callback&&b.callback(v,q[v])):b.continuous?(h(f(v-1),-s,w),h(v,0,w),h(f(v+1),s,w)):(h(v-1,-s,w),h(v,0,w),h(v+1,s,w))),u.removeEventListener('touchmove',C,!1),u.removeEventListener('touchend',C,!1)},transitionEnd:function(a){parseInt(a.target.getAttribute('data-index'),10)==v&&(z&&k(),b.transitionEnd&&b.transitionEnd.call(a,v,q[v]))}// trigger setup
};// setup event capturing
// expose the Swipe API
return c(),z&&k(),p.addEventListener?(p.touch&&u.addEventListener('touchstart',C,!1),p.transitions&&(u.addEventListener('webkitTransitionEnd',C,!1),u.addEventListener('msTransitionEnd',C,!1),u.addEventListener('oTransitionEnd',C,!1),u.addEventListener('otransitionend',C,!1),u.addEventListener('transitionend',C,!1)),window.addEventListener('resize',C,!1)):window.onresize=function(){c()},{setup:function(){c()},slide:function(a,b){l(),g(a,b)},prev:function(){l(),d()},next:function(){l(),e()},stop:function(){l()},getPos:function(){// return current index position
return v},getNumSlides:function(){// return total number of slides
return t},kill:function(){l(),u.style.width='',u.style.left='';for(// reset slides
var a,b=q.length;b--;)a=q[b],a.style.width='',a.style.left='',p.transitions&&i(b,0,0);// removed event listeners
p.addEventListener?(u.removeEventListener('touchstart',C,!1),u.removeEventListener('webkitTransitionEnd',C,!1),u.removeEventListener('msTransitionEnd',C,!1),u.removeEventListener('oTransitionEnd',C,!1),u.removeEventListener('otransitionend',C,!1),u.removeEventListener('transitionend',C,!1),window.removeEventListener('resize',C,!1)):window.onresize=null}}}}(window.jQuery||window.Zepto)&&function(a){a.fn.Swipe=function(b){return this.each(function(){a(this).data('Swipe',new Swipe(a(this)[0],b))})}}(window.jQuery||window.Zepto);
